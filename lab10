import tkinter as tk
from functools import partial

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸: Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ð¸Ð³Ñ€Ð°ÐµÑ‚ 'X', Ð±Ð¾Ñ‚ â€” 'O'
HUMAN = 'X'
BOT = 'O'


class TicTacToe:
    def __init__(self, root):
        self.root = root
        root.title("ÐšÑ€ÐµÑÑ‚Ð¸ÐºÐ¸-ÐÐ¾Ð»Ð¸ÐºÐ¸ â€” Ð¸Ð³Ñ€Ð° Ñ Ð±Ð¾Ñ‚Ð¾Ð¼")
        self.board = [''] * 9
        self.buttons = []
        self.game_over = False

        self.label = tk.Label(root, text="Ð’Ð°Ñˆ Ñ…Ð¾Ð´ (X)", font=("Arial", 14))
        self.label.grid(row=0, column=0, columnspan=3, pady=(6, 0))

        # ÐŸÐ¾Ð»Ðµ 3x3
        for i in range(9):
            btn = tk.Button(root, text='', width=6, height=3,
                            font=("Arial", 24),
                            command=partial(self.human_move, i))
            btn.grid(row=1 + i // 3, column=i % 3, padx=3, pady=3)
            self.buttons.append(btn)

        # ÐšÐ½Ð¾Ð¿ÐºÐ° Ð½Ð¾Ð²Ð¾Ð¹ Ð¸Ð³Ñ€Ñ‹
        self.reset_btn = tk.Button(root, text="ÐÐ¾Ð²Ð°Ñ Ð¸Ð³Ñ€Ð°", command=self.reset_game)
        self.reset_btn.grid(row=4, column=0, columnspan=3, pady=(6, 10))

    def human_move(self, idx):
        if self.game_over or self.board[idx]:
            return
        self.make_move(idx, HUMAN)
        winner = self.check_winner(self.board)
        if winner or all(self.board):
            self.end_game(winner)
            return
        self.label.config(text="Ð‘Ð¾Ñ‚ Ð´ÑƒÐ¼Ð°ÐµÑ‚...")
        self.root.update_idletasks()
        self.root.after(200, self.bot_move)  # Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ°Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð´Ð»Ñ ÑÑ„Ñ„ÐµÐºÑ‚Ð°

    def bot_move(self):
        idx = self.find_best_move()
        if idx is not None:
            self.make_move(idx, BOT)
        winner = self.check_winner(self.board)
        if winner or all(self.board):
            self.end_game(winner)
        else:
            self.label.config(text="Ð’Ð°Ñˆ Ñ…Ð¾Ð´ (X)")

    def make_move(self, idx, player):
        self.board[idx] = player
        self.buttons[idx].config(text=player, state='disabled')

    def end_game(self, winner):
        self.game_over = True
        if winner == HUMAN:
            self.label.config(text="Ð’Ñ‹ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸! ðŸŽ‰")
        elif winner == BOT:
            self.label.config(text="Ð‘Ð¾Ñ‚ Ð¿Ð¾Ð±ÐµÐ´Ð¸Ð».")
        else:
            self.label.config(text="ÐÐ¸Ñ‡ÑŒÑ.")
        # Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð¸Ð¼ Ð¾ÑÑ‚Ð°Ð²ÑˆÐ¸ÐµÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸
        for i, b in enumerate(self.buttons):
            b.config(state='disabled')

    def reset_game(self):
        self.board = [''] * 9
        self.game_over = False
        for b in self.buttons:
            b.config(text='', state='normal')
        self.label.config(text="Ð’Ð°Ñˆ Ñ…Ð¾Ð´ (X)")

    def check_winner(self, b):
        wins = ((0, 1, 2), (3, 4, 5), (6, 7, 8),
                (0, 3, 6), (1, 4, 7), (2, 5, 8),
                (0, 4, 8), (2, 4, 6))
        for a, c, d in wins:
            if b[a] and b[a] == b[c] == b[d]:
                return b[a]
        return None

    # Minimax: Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ (score, move_index)
    def minimax(self, board, player, depth=0):
        winner = self.check_winner(board)
        if winner == BOT:
            return 10 - depth, None
        if winner == HUMAN:
            return depth - 10, None
        if all(board):
            return 0, None

        best_move = None
        if player == BOT:
            best_score = -999
            for i in range(9):
                if not board[i]:
                    board[i] = BOT
                    score, _ = self.minimax(board, HUMAN, depth + 1)
                    board[i] = ''
                    if score > best_score:
                        best_score = score
                        best_move = i
            return best_score, best_move
        else:
            best_score = 999
            for i in range(9):
                if not board[i]:
                    board[i] = HUMAN
                    score, _ = self.minimax(board, BOT, depth + 1)
                    board[i] = ''
                    if score < best_score:
                        best_score = score
                        best_move = i
            return best_score, best_move

    def find_best_move(self):
        _, move = self.minimax(self.board[:], BOT, 0)
        return move
if __name__ == "__main__":
    root = tk.Tk()
    app = TicTacToe(root)
    root.mainloop()
